{"componentChunkName":"component---src-templates-blog-post-blog-post-tsx","path":"/post/2020-10/diffuse-materials/","result":{"data":{"markdownRemark":{"html":"<p>Next we will begin to introduce a critical concept, the material.\nA material defines how a ray interacts with a surface.\nUntil now, we have used very simple models which result in images with extremely unrealistic coloring, no lighting, and lack the ability to control the material of each surface.</p>\n<h3 id=\"a-simple-diffuse-material\" style=\"position:relative;\"><a href=\"#a-simple-diffuse-material\" aria-label=\"a simple diffuse material permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A Simple Diffuse Material</h3>\n<p>We will start with a very simple approximation for a diffuse material.\nDiffuse materials are materials which randomly scatter or absorb light, many every day objects are diffuse.</p>\n<p>To start we add a few utility functions to generate random vectors:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre style=\"counter-reset: linenumber 0\" class=\"language-rust line-numbers\"><code class=\"language-rust\"><span class=\"token keyword\">impl</span> <span class=\"token class-name\">Vec3</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Vec3</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token namespace\">random<span class=\"token punctuation\">::</span></span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token namespace\">random<span class=\"token punctuation\">::</span></span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token namespace\">random<span class=\"token punctuation\">::</span></span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">random_in_range</span><span class=\"token punctuation\">(</span>min<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">,</span> max<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Vec3</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token namespace\">random<span class=\"token punctuation\">::</span></span><span class=\"token function\">random_in_range</span><span class=\"token punctuation\">(</span>min<span class=\"token punctuation\">,</span> max<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token namespace\">random<span class=\"token punctuation\">::</span></span><span class=\"token function\">random_in_range</span><span class=\"token punctuation\">(</span>min<span class=\"token punctuation\">,</span> max<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token namespace\">random<span class=\"token punctuation\">::</span></span><span class=\"token function\">random_in_range</span><span class=\"token punctuation\">(</span>min<span class=\"token punctuation\">,</span> max<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">random_in_unit_sphere</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Vec3</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">loop</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> p <span class=\"token operator\">=</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">random_in_range</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> p<span class=\"token punctuation\">.</span><span class=\"token function\">length_squared</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">1.0</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> p<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Then simply update our <code>ray_color</code> function with a recursive call using the new reflected ray:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre style=\"counter-reset: linenumber 0\" class=\"language-rust line-numbers\"><code class=\"language-rust\"><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">ray_color</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token class-name\">Ray</span><span class=\"token punctuation\">,</span> world<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">dyn</span> <span class=\"token class-name\">Hittable</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Color</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> rec <span class=\"token operator\">=</span> <span class=\"token class-name\">HitRecord</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> world<span class=\"token punctuation\">.</span><span class=\"token function\">hit</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">::</span><span class=\"token constant\">INFINITY</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> rec<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">let</span> target <span class=\"token operator\">=</span> rec<span class=\"token punctuation\">.</span>p <span class=\"token operator\">+</span> rec<span class=\"token punctuation\">.</span>normal <span class=\"token operator\">+</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">random_in_unit_sphere</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token number\">0.5</span> <span class=\"token operator\">*</span> <span class=\"token function\">ray_color</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token class-name\">Ray</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>rec<span class=\"token punctuation\">.</span>p<span class=\"token punctuation\">,</span> target <span class=\"token operator\">-</span> rec<span class=\"token punctuation\">.</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> world<span class=\"token punctuation\">)</span></span>    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> unit_direction <span class=\"token operator\">=</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">unit_vector</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">.</span><span class=\"token function\">direction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> t <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>unit_direction<span class=\"token punctuation\">.</span><span class=\"token function\">y</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">(</span><span class=\"token number\">1.0</span> <span class=\"token operator\">-</span> t<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> t <span class=\"token operator\">*</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This results in a somewhat dark image, we will fix this later:</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/64b9b2f00947284879dbca1538a48726/d9f49/a-simple-diffuse-material.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACV0lEQVQozzWNSU8TARSA5xdoLLGokaaI7cDU6TowS5tSutMNSQQ8VGWzVMqFo1yQoBgPRhMPKCYVhLbKVkEQ8GREbEtpKAU1MdEYiEcv3tvnmxKTl5e3fN97xOsdSGQhvg3TaXiZgsnPEN2C55ulFxmYyooRTYstDidTIjCThtg2vMoCisTiLizkYBZjRxzhlZl0Kb4D9xPfQsOx0J34g9nviZx4Ov7fmcvBfA5QJN4WYHkPlvLwJi/287nS0j7cfrJhaGxVc81qzl1vuTL87AMOcZXcFTGEUUGRWD8ore0X3xWKq4XiSqG4/hUSH//wjg4159KZfHqTj+acpubgXOrv2hdY2RMxhFFBkdj6BelDyBxB6hA2fxYzv2F8IatirKp6q4ppopgmLOgGR3T1IH0Emz+KxzBmFInxxd2H059GJzaGHiUH78UiI1NtfaOkxkRqjAq1oKB5pVogtear/WMDI1ODY7Ghx8m7E+9RebqYJzhPH+Pu1dk7tbZOzHp7F+PqUeqsMoVWXsvISQaLWoOdcfXqHV0Yxxi2nDdMCIGIsaUcgYjgCze4u7WW9gu0SVIpk0irTkmrKiplNWqzztLBursRQNLUMoBZ8PcTvL+f94c5T4ht7mUcN7SWjjrWI6e40+cunpCcOVlxVnpeKad4ivXginF2IsZ5+3hfWPDfIrAqmz240FuDmsa2S0KANDhraHM1JVRTPL7FViUENOZ2vS1Y7+xCn/WE0CfK5s0Gd1m2BbWN7bTxch3rJRmXUm8nDQ4sKNZHG1vxs8F+jXFcR1i0PKF/Ib89qrb9XUcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"&quot;First render of a diffuse sphere\"\n        title=\"First render of a diffuse sphere\"\n        src=\"/static/64b9b2f00947284879dbca1538a48726/d9f49/a-simple-diffuse-material.png\"\n        srcset=\"/static/64b9b2f00947284879dbca1538a48726/0608e/a-simple-diffuse-material.png 225w,\n/static/64b9b2f00947284879dbca1538a48726/d9f49/a-simple-diffuse-material.png 400w\"\n        sizes=\"(max-width: 400px) 100vw, 400px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">First render of a diffuse sphere</figcaption>\n  </figure></p>\n<h3 id=\"limiting-the-number-of-child-rays\" style=\"position:relative;\"><a href=\"#limiting-the-number-of-child-rays\" aria-label=\"limiting the number of child rays permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Limiting the Number of Child Rays</h3>\n<p>Before we get too far ahead of ourselves there is a potential for an infinite recursion in our current implementation.\nAs it stands it would be possible for a ray to reflect back and forth between surfaces forever.</p>\n<p>Let's fix that by limiting the depth, this is a fine approximation since in the real world so much energy would have been lost that reflections after a certain point contribute very little to the final color:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre style=\"counter-reset: linenumber 0\" class=\"language-rust line-numbers\"><code class=\"language-rust\"><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">ray_color</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token class-name\">Ray</span><span class=\"token punctuation\">,</span> world<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">dyn</span> <span class=\"token class-name\">Hittable</span><span class=\"token punctuation\">,</span> depth<span class=\"token punctuation\">:</span> <span class=\"token keyword\">u32</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Color</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">if</span> depth <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span></span>\n    <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> rec <span class=\"token operator\">=</span> <span class=\"token class-name\">HitRecord</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> world<span class=\"token punctuation\">.</span><span class=\"token function\">hit</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">::</span><span class=\"token constant\">INFINITY</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> rec<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> target <span class=\"token operator\">=</span> rec<span class=\"token punctuation\">.</span>p <span class=\"token operator\">+</span> rec<span class=\"token punctuation\">.</span>normal <span class=\"token operator\">+</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">random_in_unit_sphere</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token number\">0.5</span> <span class=\"token operator\">*</span> <span class=\"token function\">ray_color</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token class-name\">Ray</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>rec<span class=\"token punctuation\">.</span>p<span class=\"token punctuation\">,</span> target <span class=\"token operator\">-</span> rec<span class=\"token punctuation\">.</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> world<span class=\"token punctuation\">,</span> depth <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></span>    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> unit_direction <span class=\"token operator\">=</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">unit_vector</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">.</span><span class=\"token function\">direction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> t <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>unit_direction<span class=\"token punctuation\">.</span><span class=\"token function\">y</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">(</span><span class=\"token number\">1.0</span> <span class=\"token operator\">-</span> t<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> t <span class=\"token operator\">*</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> aspect_ratio <span class=\"token operator\">=</span> <span class=\"token number\">16.0</span> <span class=\"token operator\">/</span> <span class=\"token number\">9.0</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">let</span> image_width <span class=\"token operator\">=</span> <span class=\"token number\">400</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> image_height <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>image_width <span class=\"token keyword\">as</span> <span class=\"token keyword\">f64</span> <span class=\"token operator\">/</span> aspect_ratio<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">u32</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> samples_per_pixel <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">let</span> max_depth <span class=\"token operator\">=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">;</span></span>\n    <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> world <span class=\"token operator\">=</span> <span class=\"token class-name\">HittableList</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    world<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Rc</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Sphere</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Point3</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    world<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Rc</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Sphere</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Point3</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">100.5</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> world <span class=\"token operator\">=</span> world<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">let</span> cam <span class=\"token operator\">=</span> <span class=\"token class-name\">Camera</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>aspect_ratio<span class=\"token punctuation\">,</span> <span class=\"token number\">2.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Point3</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token macro property\">print!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"P3\\n{} {}\\n255\\n\"</span><span class=\"token punctuation\">,</span> image_width<span class=\"token punctuation\">,</span> image_height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">..</span>image_height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">rev</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token macro property\">eprint!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\rScanlines remaining: {} \"</span><span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token number\">0</span><span class=\"token punctuation\">..</span>image_width <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> pixel_color <span class=\"token operator\">=</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token number\">0</span><span class=\"token punctuation\">..</span>samples_per_pixel <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">let</span> u <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>i <span class=\"token keyword\">as</span> <span class=\"token keyword\">f64</span> <span class=\"token operator\">+</span> <span class=\"token namespace\">random<span class=\"token punctuation\">::</span></span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>image_width <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">let</span> v <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>j <span class=\"token keyword\">as</span> <span class=\"token keyword\">f64</span> <span class=\"token operator\">+</span> <span class=\"token namespace\">random<span class=\"token punctuation\">::</span></span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">f64</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>image_height <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">let</span> r <span class=\"token operator\">=</span> cam<span class=\"token punctuation\">.</span><span class=\"token function\">get_ray</span><span class=\"token punctuation\">(</span>u<span class=\"token punctuation\">,</span> v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">                pixel_color <span class=\"token operator\">+=</span> <span class=\"token function\">ray_color</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>r<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>world<span class=\"token punctuation\">,</span> max_depth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>            <span class=\"token punctuation\">}</span>\n            <span class=\"token function\">write_color</span><span class=\"token punctuation\">(</span><span class=\"token namespace\">io<span class=\"token punctuation\">::</span></span><span class=\"token function\">stdout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">borrow_mut</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> pixel_color<span class=\"token punctuation\">,</span> samples_per_pixel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token macro property\">eprint!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\nDone.\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"using-gamma-correction-for-accurate-color-intensity\" style=\"position:relative;\"><a href=\"#using-gamma-correction-for-accurate-color-intensity\" aria-label=\"using gamma correction for accurate color intensity permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using Gamma Correction for Accurate Color Intensity</h3>\n<p>As previously mentioned our image is a bit dark, this is because we need to account for gamma correction.\nGamma correction is a concept I don't fully understand, but it has to do with how we perceive brightness, how monitors display colors, how we map non-linear functions to linear values.\nSuffice to say we can fix our brightness problem with a small change:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre style=\"counter-reset: linenumber 0\" class=\"language-rust line-numbers\"><code class=\"language-rust\"><span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">write_color</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> <span class=\"token keyword\">impl</span> <span class=\"token class-name\">Write</span><span class=\"token punctuation\">,</span> color<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">,</span> samples_per_pixel<span class=\"token punctuation\">:</span> <span class=\"token keyword\">u32</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span>io<span class=\"token punctuation\">::</span></span><span class=\"token class-name\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> scale <span class=\"token operator\">=</span> <span class=\"token number\">1.0</span> <span class=\"token operator\">/</span> samples_per_pixel <span class=\"token keyword\">as</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">let</span> r <span class=\"token operator\">=</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">::</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span>color<span class=\"token punctuation\">.</span><span class=\"token function\">x</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> scale<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">let</span> g <span class=\"token operator\">=</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">::</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span>color<span class=\"token punctuation\">.</span><span class=\"token function\">y</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> scale<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">let</span> b <span class=\"token operator\">=</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">::</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span>color<span class=\"token punctuation\">.</span><span class=\"token function\">z</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> scale<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n    <span class=\"token macro property\">write!</span><span class=\"token punctuation\">(</span>\n        f<span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"{} {} {}\\n\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">(</span><span class=\"token number\">256.0</span> <span class=\"token operator\">*</span> <span class=\"token function\">clamp</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.999</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">u32</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">(</span><span class=\"token number\">256.0</span> <span class=\"token operator\">*</span> <span class=\"token function\">clamp</span><span class=\"token punctuation\">(</span>g<span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.999</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">u32</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">(</span><span class=\"token number\">256.0</span> <span class=\"token operator\">*</span> <span class=\"token function\">clamp</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.999</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">u32</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>From this we get an image which looks much better:</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ae50ed221278c4c406b788310547d255/d9f49/gamma-corrected.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACPklEQVQozyWPy28SURjF5w/rxlQXNdZNTayKjwKWZxnKwDDDGB6lDJQBq7YSm0CHRzVRk0qj0WqMsjAiBToIQmt80YEB2oVRu3Aln9+E5OTec+/5nfvlErUuSB2odqDSgbIMOwdQOoDiD9jBG0UVGjyW2mqEAJLVLux2AYtEowf1HnxUoKaAhLeYySAp8LzcS24WU08+bFcHeKzIaoQAYgjXFWgoQLT60BpAsw+fetBQXxm2DuHx6wblv01yMZITnIE7m4W91pEaIYBYs6dWUMT+4XB/oGqvP2z1/30+gsq3Yzq4YmMjdk6w3xDmmLCHT9TafzFCBjXisUjIv6DzG5Rj6P6B9s8hmjfl72bXoskZNFJ+IxVAY6H5d/XOCMAVGaxgkXi7K78ofs0Xmg9fStmnJTH/Pp7c0tk4rdUzY2G0FlY757lOepfFZ2K+iMCjV9JWobld/FKQZIIVcnQkQ/Eixa87wyLKFU5rSd+0ltTMOlEXdKRufsG1lFFTXnQgxov0UpYRNghP/D6HuvkADStkXeF10nf3spkbP3P+xMQU6tTk9BWrlwwkMGKE7Ajm4ipPsLENHM5Es3Qk7QwlSX/CQEcvGpiJqWtjJ8+OjU+ePjdzycga3AJGCLiX0ggzsRwWCUbIuaMZtcmn5hfWbN5VExPXOxavWr0ak0djZNHoHSETG7f5Vh3BNYpPIcxEMziSwA1Fq/9JYWbzrpg9yzhc7+B1jpCe4mddESMTs3C3sGwP3KNCSTqCf1bn/wcblLH2eqpnaQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Diffuse sphere, with gamma correction\"\n        title=\"Diffuse sphere, with gamma correction\"\n        src=\"/static/ae50ed221278c4c406b788310547d255/d9f49/gamma-corrected.png\"\n        srcset=\"/static/ae50ed221278c4c406b788310547d255/0608e/gamma-corrected.png 225w,\n/static/ae50ed221278c4c406b788310547d255/d9f49/gamma-corrected.png 400w\"\n        sizes=\"(max-width: 400px) 100vw, 400px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Diffuse sphere, with gamma correction</figcaption>\n  </figure></p>\n<h3 id=\"fixing-shadow-acne\" style=\"position:relative;\"><a href=\"#fixing-shadow-acne\" aria-label=\"fixing shadow acne permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fixing Shadow Acne</h3>\n<p>Looking closely at the image you will probably see many small black pixels, this is due to a small bug in the original code.\nThis is caused by problems with floating-point approximation very close to the surface, this can be avoided by setting <code>t_min</code> to a very small value instead of <code>0</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre style=\"counter-reset: linenumber 0\" class=\"language-rust line-numbers\"><code class=\"language-rust\"><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">ray_color</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token class-name\">Ray</span><span class=\"token punctuation\">,</span> world<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">dyn</span> <span class=\"token class-name\">Hittable</span><span class=\"token punctuation\">,</span> depth<span class=\"token punctuation\">:</span> <span class=\"token keyword\">u32</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Color</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> depth <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> rec <span class=\"token operator\">=</span> <span class=\"token class-name\">HitRecord</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">if</span> world<span class=\"token punctuation\">.</span><span class=\"token function\">hit</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> <span class=\"token number\">0.001</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">::</span><span class=\"token constant\">INFINITY</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> rec<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span>        <span class=\"token keyword\">let</span> target <span class=\"token operator\">=</span> rec<span class=\"token punctuation\">.</span>p <span class=\"token operator\">+</span> rec<span class=\"token punctuation\">.</span>normal <span class=\"token operator\">+</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">random_in_unit_sphere</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token number\">0.5</span> <span class=\"token operator\">*</span> <span class=\"token function\">ray_color</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token class-name\">Ray</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>rec<span class=\"token punctuation\">.</span>p<span class=\"token punctuation\">,</span> target <span class=\"token operator\">-</span> rec<span class=\"token punctuation\">.</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> world<span class=\"token punctuation\">,</span> depth <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> unit_direction <span class=\"token operator\">=</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">unit_vector</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">.</span><span class=\"token function\">direction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> t <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>unit_direction<span class=\"token punctuation\">.</span><span class=\"token function\">y</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">(</span><span class=\"token number\">1.0</span> <span class=\"token operator\">-</span> t<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> t <span class=\"token operator\">*</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ef091faa1d80e018a773dfdc08527b27/d9f49/fixing-shadow-acne.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACMElEQVQozzWOW28SURRG59/poya1b1r1SWurhUAvQIGZYSjSdihhhrm0pkoiFBRmoKAmYGLVYLAUWpBLE7XlMlyaWLUPJr6w3YOafDnZ53xr7RzisAvlDhx0oNiB/TZ8bEGhBR9OoIBzF/a7+qBfT/UKgYMxXOoCikS1B5UeHGlwqEG5CyXs2lDSIHf0bSdb28nVX1fPyxoU23qFAGIIVzSoakDU+1AfQK0Pn3pQ1beMagNI578+lOIrwZibj3rlxMtCCx+xQgCx2lhBkWgOR3oGo8Y4x2dQOvm1KicYLuIRYhgmEGa31KP27+YQ/jIIo3I8HBGtH9D5Cd0L/Tw9H+HwvqI52cf0RojC+PSQvlChcaYD30edi38wisS7aj9XbGfyn5W9ZixbCb86FKJvLCuS1SOPg4Nk8cjSs7dYxbJVZa/xIv8FFRQJl5SmhKSDUx2c4uRVJ6+QvGp2iQa7z0RyJjIwt8zOMzI5rhDQMU5FBUXCLWfcm+PIaUZKkXzCyoanLezE1P2JqRnMtZsPZqwbNjZM8gojphD7z2cIRk67pF2XmKSCSWcgbmUjJmbzzoJ38tbcpSvXL1+9MXnbeHdx1ezesvkizsBzSlBpMcWIuygSLjFF66ZKBuIOf9S6/nTes20ghVnbxvTS2r2ltdllv4ESFjzb1vWw3R8juTjCtJBCkcA1dFClggpuXUaZDS95n5jdj4y0ZKRFAyUaKRGvi94QVnZ/1Ikyr6CPn/0DmMfM4L/9PioAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Diffuse sphere, with gamma correction, and no shadow acne\"\n        title=\"Diffuse sphere, with gamma correction, and no shadow acne\"\n        src=\"/static/ef091faa1d80e018a773dfdc08527b27/d9f49/fixing-shadow-acne.png\"\n        srcset=\"/static/ef091faa1d80e018a773dfdc08527b27/0608e/fixing-shadow-acne.png 225w,\n/static/ef091faa1d80e018a773dfdc08527b27/d9f49/fixing-shadow-acne.png 400w\"\n        sizes=\"(max-width: 400px) 100vw, 400px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Diffuse sphere, with gamma correction, and no shadow acne</figcaption>\n  </figure></p>\n<h3 id=\"true-lambertian-reflection\" style=\"position:relative;\"><a href=\"#true-lambertian-reflection\" aria-label=\"true lambertian reflection permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>True Lambertian Reflection</h3>\n<p>The current approximation we are using for Lambertian has a higher probability of reflecting rays near the surface normal than a true Lambertian distribution.\nTo correct this we modify the approach for generating reflection rays:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre style=\"counter-reset: linenumber 0\" class=\"language-rust line-numbers\"><code class=\"language-rust\"><span class=\"token keyword\">impl</span> <span class=\"token class-name\">Vec3</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">random_unit_vector</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Vec3</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> a <span class=\"token operator\">=</span> <span class=\"token function\">random_in_range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2.0</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">::</span><span class=\"token namespace\">consts<span class=\"token punctuation\">::</span></span><span class=\"token constant\">PI</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> z <span class=\"token operator\">=</span> <span class=\"token function\">random_in_range</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> r <span class=\"token operator\">=</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">::</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span><span class=\"token number\">1.0</span> <span class=\"token operator\">-</span> z <span class=\"token operator\">*</span> z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>r <span class=\"token operator\">*</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">::</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> r <span class=\"token operator\">*</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">::</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> z<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Our <code>ray_color</code> function:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre style=\"counter-reset: linenumber 0\" class=\"language-rust line-numbers\"><code class=\"language-rust\"><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">ray_color</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token class-name\">Ray</span><span class=\"token punctuation\">,</span> world<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">dyn</span> <span class=\"token class-name\">Hittable</span><span class=\"token punctuation\">,</span> depth<span class=\"token punctuation\">:</span> <span class=\"token keyword\">u32</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Color</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> depth <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> rec <span class=\"token operator\">=</span> <span class=\"token class-name\">HitRecord</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> world<span class=\"token punctuation\">.</span><span class=\"token function\">hit</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> <span class=\"token number\">0.001</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">::</span><span class=\"token constant\">INFINITY</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> rec<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">let</span> target <span class=\"token operator\">=</span> rec<span class=\"token punctuation\">.</span>p <span class=\"token operator\">+</span> rec<span class=\"token punctuation\">.</span>normal <span class=\"token operator\">+</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">random_unit_vector</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>        <span class=\"token number\">0.5</span> <span class=\"token operator\">*</span> <span class=\"token function\">ray_color</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token class-name\">Ray</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>rec<span class=\"token punctuation\">.</span>p<span class=\"token punctuation\">,</span> target <span class=\"token operator\">-</span> rec<span class=\"token punctuation\">.</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> world<span class=\"token punctuation\">,</span> depth <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> unit_direction <span class=\"token operator\">=</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">unit_vector</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">.</span><span class=\"token function\">direction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> t <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>unit_direction<span class=\"token punctuation\">.</span><span class=\"token function\">y</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">(</span><span class=\"token number\">1.0</span> <span class=\"token operator\">-</span> t<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> t <span class=\"token operator\">*</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The differences in the result are subtle, and most noticeable by looking at the shadows:</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b0d00686de9d2b0813a0576b30b13f8f/d9f49/true-lambertian.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACIUlEQVQozzWP62/SYBTG+4/uw5Jl+7JEw2UCc1AovYDbYEALpWTilDGw3DFRxKgLZpsL99uWaBDWwjBeph+W+KXHU5zJkzfPe57f856WaCnQvIL6QucT+DiGszGcjOAMvQLnim706xc9QkAnFWgogEWiO4XOFNoqtFRo4hSzCTRUeN3+dljpJSu9aud7U10Mr3QAMYQ7KnRVIAYzGFxDfwa9KXT1V7T+HIq1T3Qo5dpLUHsJhk+/OB3hECMEEOtP9QqKuJhruq614UKXX6ExuuWEtNP/1B1M0sGk03fgFTPtyZ+LOfxjEMbK5VwjxjcwuQHlN1z9gtEPDU2trdq398mduGMhcjeO/nQw14GfGp7IYAWLRK07e1Mfvzz5XHg/lKudVKUlpt9ZWXGTi6JsaFCeqCQfp1615Gq3eDxE+G198qE3IzipxIgFSshRfPb/mbWyURPp36BCGxSPxspJbiF7Bwj6SYtFTioTnljZI5W8UomTikwkT/Gyw5cwOvmVe1vL69blddvKfbuJEhz+hJuXWTHPRYvI661YmeCiBVYs0JG8W8i4gmls2jz7BjKwanAtrZqW1sxrRspABnHo8B+6Qs/xE+hwjsXN0SLBiHkmnHPzGQzIwJF999nmo/gDVjJTgtEZQpmpsIWN4RAjZ+DIxWM/wwg5LBJMJEeH8X/ku7Iv8XD7ic372MLFLKyEr6DB5tbOAUZYpnA5L+v7I/m/on7P1Q23lcwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Correct rendering of Lambertian spheres\"\n        title=\"Correct rendering of Lambertian spheres\"\n        src=\"/static/b0d00686de9d2b0813a0576b30b13f8f/d9f49/true-lambertian.png\"\n        srcset=\"/static/b0d00686de9d2b0813a0576b30b13f8f/0608e/true-lambertian.png 225w,\n/static/b0d00686de9d2b0813a0576b30b13f8f/d9f49/true-lambertian.png 400w\"\n        sizes=\"(max-width: 400px) 100vw, 400px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Correct rendering of Lambertian spheres</figcaption>\n  </figure></p>\n<h3 id=\"an-alternative-diffuse-formulation\" style=\"position:relative;\"><a href=\"#an-alternative-diffuse-formulation\" aria-label=\"an alternative diffuse formulation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>An Alternative Diffuse Formulation</h3>\n<p>For now, I will skip this section, it presents another <em>less accurate</em> approximation for Lambertian surfaces.\nWhen we get to the chapter which adds an abstraction for materials we may revisit and add each of these approximations, so we can see their effect on more complex scenes.</p>\n<p>The complete code is <a href=\"https://github.com/austindoupnik/ray-tracing-in-one-weekend-with-rust/tree/v0.0.1-chapter.8\">available here</a>.</p>","frontmatter":{"title":"Ch 8. Diffuse Materials","series":{"title":"Ray Tracing in One Weekend with Rust","part":7},"date":"October 23, 2020","tags":["rust","ray tracing"]},"fields":{"slug":"/post/2020-10/diffuse-materials/"}}},"pageContext":{"slug":"/post/2020-10/diffuse-materials/","previous":{"fields":{"slug":"/post/2020-10/antialiasing/"},"frontmatter":{"title":"Ch 7. Antialiasing"}},"next":{"fields":{"slug":"/post/2020-10/metal/"},"frontmatter":{"title":"Ch 9. Metal"}}}},"staticQueryHashes":["1242404783","1672915144","1933047930","2463615370"]}