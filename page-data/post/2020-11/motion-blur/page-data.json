{"componentChunkName":"component---src-templates-blog-post-blog-post-tsx","path":"/post/2020-11/motion-blur/","result":{"data":{"markdownRemark":{"html":"<p>With the start of November I'll be moving on to the next book in the <a href=\"https://raytracing.github.io/\">Ray Tracing in One Weekend - The Book Series</a>, <a href=\"https://raytracing.github.io/books/RayTracingTheNextWeek.html\">Ray Tracing The Next Week</a>.</p>\n<p>This book will cover a few more advanced techniques, so let's dig in with the second chapter, <a href=\"https://raytracing.github.io/books/RayTracingTheNextWeek.html#motionblur\">Motion Blur</a>.</p>\n<h3 id=\"introduction-of-spacetime-ray-tracing\" style=\"position:relative;\"><a href=\"#introduction-of-spacetime-ray-tracing\" aria-label=\"introduction of spacetime ray tracing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction of SpaceTime Ray Tracing</h3>\n<p>First let's update the <code>Ray</code> struct to store the time of the ray's creation:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre style=\"counter-reset: linenumber 0\" class=\"language-rust line-numbers\"><code class=\"language-rust\"><span class=\"token keyword\">pub</span> <span class=\"token keyword\">struct</span> <span class=\"token type-definition class-name\">Ray</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">pub</span> origin<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Point3</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">pub</span> dir<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">pub</span> time<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">,</span></span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">impl</span> <span class=\"token class-name\">Ray</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">new</span><span class=\"token punctuation\">(</span>origin<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Point3</span><span class=\"token punctuation\">,</span> dir<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">,</span> time<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Ray</span> <span class=\"token punctuation\">{</span></span>        <span class=\"token class-name\">Ray</span> <span class=\"token punctuation\">{</span>\n            origin<span class=\"token punctuation\">,</span>\n            dir<span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">            time<span class=\"token punctuation\">,</span></span>        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">origin</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Point3</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>origin\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">direction</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Vec3</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>dir\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">at</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> t<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Point3</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>origin <span class=\"token operator\">+</span> t <span class=\"token operator\">*</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>dir\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">time</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token keyword\">f64</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>time</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"updating-the-camera-to-simulate-motion-blur\" style=\"position:relative;\"><a href=\"#updating-the-camera-to-simulate-motion-blur\" aria-label=\"updating the camera to simulate motion blur permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Updating the Camera to Simulate Motion Blur</h3>\n<p>Next let's emulate the open and close of a camera shutter, by adding a start and end time to our <code>Camera</code> and\nassigning each ray a random time between these two times:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre style=\"counter-reset: linenumber 0\" class=\"language-rust line-numbers\"><code class=\"language-rust\"><span class=\"token keyword\">pub</span> <span class=\"token keyword\">struct</span> <span class=\"token type-definition class-name\">Camera</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">pub</span> origin<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Point3</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">pub</span> lower_left_corner<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Point3</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">pub</span> horizontal<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">pub</span> vertical<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">pub</span> lens_radius<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">pub</span> u<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">pub</span> v<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">pub</span> time0<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">pub</span> time1<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">,</span></span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">impl</span> <span class=\"token class-name\">Camera</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">new</span><span class=\"token punctuation\">(</span>\n        lookfrom<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Point3</span><span class=\"token punctuation\">,</span>\n        lookat<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Point3</span><span class=\"token punctuation\">,</span>\n        vup<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">,</span>\n        fov<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">,</span>\n        aspect_ratio<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">,</span>\n        aperture<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">,</span>\n        focus_dist<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">        time0<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">        time1<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">,</span></span>    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Camera</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> theta <span class=\"token operator\">=</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">::</span><span class=\"token function\">to_radians</span><span class=\"token punctuation\">(</span>fov<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> h <span class=\"token operator\">=</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">::</span><span class=\"token function\">tan</span><span class=\"token punctuation\">(</span>theta <span class=\"token operator\">/</span> <span class=\"token number\">2.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> viewport_height <span class=\"token operator\">=</span> <span class=\"token number\">2.0</span> <span class=\"token operator\">*</span> h<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> viewport_width <span class=\"token operator\">=</span> aspect_ratio <span class=\"token operator\">*</span> viewport_height<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">let</span> w <span class=\"token operator\">=</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">unit_vector</span><span class=\"token punctuation\">(</span>lookfrom <span class=\"token operator\">-</span> lookat<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> u <span class=\"token operator\">=</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">unit_vector</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">cross</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>vup<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>w<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> v <span class=\"token operator\">=</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">cross</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>w<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>u<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">let</span> origin <span class=\"token operator\">=</span> lookfrom<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> horizontal <span class=\"token operator\">=</span> focus_dist <span class=\"token operator\">*</span> viewport_width <span class=\"token operator\">*</span> u<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> vertical <span class=\"token operator\">=</span> focus_dist <span class=\"token operator\">*</span> viewport_height <span class=\"token operator\">*</span> v<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> lower_left_corner <span class=\"token operator\">=</span> origin <span class=\"token operator\">-</span> horizontal <span class=\"token operator\">/</span> <span class=\"token number\">2.0</span> <span class=\"token operator\">-</span> vertical <span class=\"token operator\">/</span> <span class=\"token number\">2.0</span> <span class=\"token operator\">-</span> focus_dist <span class=\"token operator\">*</span> w<span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">Camera</span> <span class=\"token punctuation\">{</span>\n            origin<span class=\"token punctuation\">,</span>\n            horizontal<span class=\"token punctuation\">,</span>\n            vertical<span class=\"token punctuation\">,</span>\n            lower_left_corner<span class=\"token punctuation\">,</span>\n            lens_radius<span class=\"token punctuation\">:</span> aperture <span class=\"token operator\">/</span> <span class=\"token number\">2.0</span><span class=\"token punctuation\">,</span>\n            u<span class=\"token punctuation\">,</span>\n            v<span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">            time0<span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">            time1<span class=\"token punctuation\">,</span></span>        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">get_ray</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">,</span> t<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Ray</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> rd <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>lens_radius <span class=\"token operator\">*</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">random_in_unit_disk</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> offset <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>u <span class=\"token operator\">*</span> rd<span class=\"token punctuation\">.</span><span class=\"token function\">x</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>v <span class=\"token operator\">*</span> rd<span class=\"token punctuation\">.</span><span class=\"token function\">y</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">Ray</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>origin <span class=\"token operator\">+</span> offset<span class=\"token punctuation\">,</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>lower_left_corner <span class=\"token operator\">+</span> s <span class=\"token operator\">*</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>horizontal <span class=\"token operator\">+</span> t <span class=\"token operator\">*</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>vertical <span class=\"token operator\">-</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>origin <span class=\"token operator\">-</span> offset<span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">            <span class=\"token function\">random_in_range</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>time0<span class=\"token punctuation\">,</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>time1<span class=\"token punctuation\">)</span></span>        <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"adding-moving-spheres\" style=\"position:relative;\"><a href=\"#adding-moving-spheres\" aria-label=\"adding moving spheres permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Adding Moving Spheres</h3>\n<p>Now we need to be able to add moving objects to the scene.\nLet's add a sphere which is moving between two points, <code>center0</code> at time <code>time0</code> and <code>center1</code> at time <code>time1</code>, adding a method to determine the sphere position at a given time point with a linear interpolation between the two center points.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre style=\"counter-reset: linenumber 0\" class=\"language-rust line-numbers\"><code class=\"language-rust\"><span class=\"token keyword\">pub</span> <span class=\"token keyword\">struct</span> <span class=\"token type-definition class-name\">MovingSphere</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">pub</span> center0<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Point3</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">pub</span> center1<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Point3</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">pub</span> time0<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">pub</span> time1<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">pub</span> radius<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">pub</span> mat_ptr<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Rc</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">dyn</span> <span class=\"token class-name\">Material</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">impl</span> <span class=\"token class-name\">MovingSphere</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">new</span><span class=\"token punctuation\">(</span>center0<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Point3</span><span class=\"token punctuation\">,</span> center1<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Point3</span><span class=\"token punctuation\">,</span> time0<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">,</span> time1<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">,</span> radius<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">,</span> mat_ptr<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Rc</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">dyn</span> <span class=\"token class-name\">Material</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token keyword\">Self</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">MovingSphere</span> <span class=\"token punctuation\">{</span>\n            center0<span class=\"token punctuation\">,</span>\n            center1<span class=\"token punctuation\">,</span>\n            time0<span class=\"token punctuation\">,</span>\n            time1<span class=\"token punctuation\">,</span>\n            radius<span class=\"token punctuation\">,</span>\n            mat_ptr<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">center</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> time<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Point3</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>center0 <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>time <span class=\"token operator\">-</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>time0<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>time1 <span class=\"token operator\">-</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>time0<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>center1 <span class=\"token operator\">-</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>center0<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The <code>hit</code> function for a <code>MovingSphere</code> looks largely the same as the <code>hit</code> function for a <code>Sphere</code>.\nThe only difference is that we determine the center of the sphere based on the time of the ray's creation:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre style=\"counter-reset: linenumber 0\" class=\"language-rust line-numbers\"><code class=\"language-rust\"><span class=\"token keyword\">impl</span> <span class=\"token class-name\">Hittable</span> <span class=\"token keyword\">for</span> <span class=\"token class-name\">MovingSphere</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">hit</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token class-name\">Ray</span><span class=\"token punctuation\">,</span> t_min<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">,</span> t_max<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">,</span> rec<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> <span class=\"token class-name\">HitRecord</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token keyword\">bool</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">let</span> oc <span class=\"token operator\">=</span> r<span class=\"token punctuation\">.</span><span class=\"token function\">origin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">center</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">.</span><span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>        <span class=\"token keyword\">let</span> a <span class=\"token operator\">=</span> r<span class=\"token punctuation\">.</span><span class=\"token function\">direction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">length_squared</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> half_b <span class=\"token operator\">=</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">dot</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>oc<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>r<span class=\"token punctuation\">.</span><span class=\"token function\">direction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> c <span class=\"token operator\">=</span> oc<span class=\"token punctuation\">.</span><span class=\"token function\">length_squared</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>radius <span class=\"token operator\">*</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>radius<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> discriminant <span class=\"token operator\">=</span> half_b <span class=\"token operator\">*</span> half_b <span class=\"token operator\">-</span> a <span class=\"token operator\">*</span> c<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> discriminant <span class=\"token operator\">></span> <span class=\"token number\">0.0</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> root <span class=\"token operator\">=</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">::</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span>discriminant<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">let</span> temp <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>half_b <span class=\"token operator\">-</span> root<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> a<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> temp <span class=\"token operator\">&lt;</span> t_max <span class=\"token operator\">&amp;&amp;</span> temp <span class=\"token operator\">></span> t_min <span class=\"token punctuation\">{</span>\n                rec<span class=\"token punctuation\">.</span>t <span class=\"token operator\">=</span> temp<span class=\"token punctuation\">;</span>\n                rec<span class=\"token punctuation\">.</span>p <span class=\"token operator\">=</span> r<span class=\"token punctuation\">.</span><span class=\"token function\">at</span><span class=\"token punctuation\">(</span>rec<span class=\"token punctuation\">.</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">                <span class=\"token keyword\">let</span> outward_normal <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>rec<span class=\"token punctuation\">.</span>p <span class=\"token operator\">-</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">center</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">.</span><span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>radius<span class=\"token punctuation\">;</span></span>                rec<span class=\"token punctuation\">.</span><span class=\"token function\">set_face_normal</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>outward_normal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                rec<span class=\"token punctuation\">.</span>mat_ptr <span class=\"token operator\">=</span> <span class=\"token class-name\">Some</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>mat_ptr<span class=\"token punctuation\">.</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">let</span> temp <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>half_b <span class=\"token operator\">+</span> root<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> a<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> temp <span class=\"token operator\">&lt;</span> t_max <span class=\"token operator\">&amp;&amp;</span> temp <span class=\"token operator\">></span> t_min <span class=\"token punctuation\">{</span>\n                rec<span class=\"token punctuation\">.</span>t <span class=\"token operator\">=</span> temp<span class=\"token punctuation\">;</span>\n                rec<span class=\"token punctuation\">.</span>p <span class=\"token operator\">=</span> r<span class=\"token punctuation\">.</span><span class=\"token function\">at</span><span class=\"token punctuation\">(</span>rec<span class=\"token punctuation\">.</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">                <span class=\"token keyword\">let</span> outward_normal <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>rec<span class=\"token punctuation\">.</span>p <span class=\"token operator\">-</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">center</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">.</span><span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>radius<span class=\"token punctuation\">;</span></span>                rec<span class=\"token punctuation\">.</span><span class=\"token function\">set_face_normal</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>outward_normal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                rec<span class=\"token punctuation\">.</span>mat_ptr <span class=\"token operator\">=</span> <span class=\"token class-name\">Some</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>mat_ptr<span class=\"token punctuation\">.</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"tracking-the-time-of-ray-intersection\" style=\"position:relative;\"><a href=\"#tracking-the-time-of-ray-intersection\" aria-label=\"tracking the time of ray intersection permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tracking the Time of Ray Intersection</h3>\n<p>Let's make a few small changes to our <code>Material</code>s to track the time of the ray.\nFirst our <code>Lambertian</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre style=\"counter-reset: linenumber 0\" class=\"language-rust line-numbers\"><code class=\"language-rust\"><span class=\"token keyword\">impl</span> <span class=\"token class-name\">Material</span> <span class=\"token keyword\">for</span> <span class=\"token class-name\">Lambertian</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">scatter</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> r_in<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token class-name\">Ray</span><span class=\"token punctuation\">,</span> rec<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token class-name\">HitRecord</span><span class=\"token punctuation\">,</span> attenuation<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">,</span> scattered<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> <span class=\"token class-name\">Ray</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token keyword\">bool</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> scatter_direction <span class=\"token operator\">=</span> rec<span class=\"token punctuation\">.</span>normal <span class=\"token operator\">+</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">random_unit_vector</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token operator\">*</span>scattered <span class=\"token operator\">=</span> <span class=\"token class-name\">Ray</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>rec<span class=\"token punctuation\">.</span>p<span class=\"token punctuation\">,</span> scatter_direction<span class=\"token punctuation\">,</span> r_in<span class=\"token punctuation\">.</span><span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>        <span class=\"token operator\">*</span>attenuation <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>albedo<span class=\"token punctuation\">;</span>\n\n        <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Then our <code>Metal</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre style=\"counter-reset: linenumber 0\" class=\"language-rust line-numbers\"><code class=\"language-rust\"><span class=\"token keyword\">impl</span> <span class=\"token class-name\">Material</span> <span class=\"token keyword\">for</span> <span class=\"token class-name\">Metal</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">scatter</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> r_in<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token class-name\">Ray</span><span class=\"token punctuation\">,</span> rec<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token class-name\">HitRecord</span><span class=\"token punctuation\">,</span> attenuation<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">,</span> scattered<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> <span class=\"token class-name\">Ray</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token keyword\">bool</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> reflected <span class=\"token operator\">=</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">reflect</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">unit_vector</span><span class=\"token punctuation\">(</span>r_in<span class=\"token punctuation\">.</span><span class=\"token function\">direction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>rec<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token operator\">*</span>scattered <span class=\"token operator\">=</span> <span class=\"token class-name\">Ray</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>rec<span class=\"token punctuation\">.</span>p<span class=\"token punctuation\">,</span> reflected <span class=\"token operator\">+</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>fuzz <span class=\"token operator\">*</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">random_in_unit_sphere</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> r_in<span class=\"token punctuation\">.</span><span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>        <span class=\"token operator\">*</span>attenuation <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>albedo<span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">dot</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>scattered<span class=\"token punctuation\">.</span><span class=\"token function\">direction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>rec<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0.0</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Finally, our <code>Dielectric</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre style=\"counter-reset: linenumber 0\" class=\"language-rust line-numbers\"><code class=\"language-rust\"><span class=\"token keyword\">impl</span> <span class=\"token class-name\">Material</span> <span class=\"token keyword\">for</span> <span class=\"token class-name\">Dielectric</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">scatter</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> r_in<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token class-name\">Ray</span><span class=\"token punctuation\">,</span> rec<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token class-name\">HitRecord</span><span class=\"token punctuation\">,</span> attenuation<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">,</span> scattered<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> <span class=\"token class-name\">Ray</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token keyword\">bool</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">*</span>attenuation <span class=\"token operator\">=</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> refraction_ratio <span class=\"token operator\">=</span> <span class=\"token keyword\">if</span> rec<span class=\"token punctuation\">.</span>front_face <span class=\"token punctuation\">{</span>\n            <span class=\"token number\">1.0</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>ir\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>ir\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">let</span> unit_direction <span class=\"token operator\">=</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">unit_vector</span><span class=\"token punctuation\">(</span>r_in<span class=\"token punctuation\">.</span><span class=\"token function\">direction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> cos_theta <span class=\"token operator\">=</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">::</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">dot</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token operator\">-</span>unit_direction<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>rec<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> sin_theta <span class=\"token operator\">=</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">::</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span><span class=\"token number\">1.0</span> <span class=\"token operator\">-</span> cos_theta <span class=\"token operator\">*</span> cos_theta<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">let</span> direction <span class=\"token operator\">=</span> <span class=\"token keyword\">if</span> refraction_ratio <span class=\"token operator\">*</span> sin_theta <span class=\"token operator\">></span> <span class=\"token number\">1.0</span> <span class=\"token operator\">||</span> <span class=\"token class-name\">Dielectric</span><span class=\"token punctuation\">::</span><span class=\"token function\">reflectance</span><span class=\"token punctuation\">(</span>cos_theta<span class=\"token punctuation\">,</span> refraction_ratio<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">reflect</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>unit_direction<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>rec<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">refract</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>unit_direction<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>rec<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">,</span> refraction_ratio<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token operator\">*</span>scattered <span class=\"token operator\">=</span> <span class=\"token class-name\">Ray</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>rec<span class=\"token punctuation\">.</span>p<span class=\"token punctuation\">,</span> direction<span class=\"token punctuation\">,</span> r_in<span class=\"token punctuation\">.</span><span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n        <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"putting-everything-together\" style=\"position:relative;\"><a href=\"#putting-everything-together\" aria-label=\"putting everything together permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Putting Everything Together</h3>\n<p>Let's add some <code>MovingSphere</code>s to our scene:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre style=\"counter-reset: linenumber 0\" class=\"language-rust line-numbers\"><code class=\"language-rust\"><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">random_scene</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">HittableList</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> world <span class=\"token operator\">=</span> <span class=\"token class-name\">HittableList</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">let</span> ground_material <span class=\"token operator\">=</span> <span class=\"token class-name\">Lambertian</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Color</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    world<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Rc</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Sphere</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Point3</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1000.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000.0</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Rc</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>ground_material<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">for</span> a <span class=\"token keyword\">in</span> <span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token punctuation\">..</span><span class=\"token number\">11</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">for</span> b <span class=\"token keyword\">in</span> <span class=\"token operator\">-</span><span class=\"token number\">11</span><span class=\"token punctuation\">..</span><span class=\"token number\">11</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> choose_mat <span class=\"token operator\">=</span> <span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">let</span> center <span class=\"token operator\">=</span> <span class=\"token class-name\">Point3</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>a <span class=\"token keyword\">as</span> <span class=\"token keyword\">f64</span> <span class=\"token operator\">+</span> <span class=\"token number\">0.9</span> <span class=\"token operator\">*</span> <span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.2</span><span class=\"token punctuation\">,</span> b <span class=\"token keyword\">as</span> <span class=\"token keyword\">f64</span> <span class=\"token operator\">+</span> <span class=\"token number\">0.9</span> <span class=\"token operator\">*</span> <span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>center <span class=\"token operator\">-</span> <span class=\"token class-name\">Point3</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">4.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0.9</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">                <span class=\"token keyword\">if</span> choose_mat <span class=\"token operator\">&lt;</span> <span class=\"token number\">0.8</span> <span class=\"token punctuation\">{</span></span>                    <span class=\"token keyword\">let</span> albedo <span class=\"token operator\">=</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">::</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">::</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">let</span> sphere_material <span class=\"token operator\">=</span> <span class=\"token class-name\">Rc</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Lambertian</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>albedo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">                    <span class=\"token keyword\">let</span> center1 <span class=\"token operator\">=</span> center <span class=\"token operator\">+</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token function\">random_in_range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">                    world<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Rc</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MovingSphere</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>center<span class=\"token punctuation\">,</span> center1<span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.2</span><span class=\"token punctuation\">,</span> sphere_material<span class=\"token punctuation\">.</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>                <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> choose_mat <span class=\"token operator\">&lt;</span> <span class=\"token number\">0.95</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">let</span> albedo <span class=\"token operator\">=</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">::</span><span class=\"token function\">random_in_range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">let</span> fuzz <span class=\"token operator\">=</span> <span class=\"token function\">random_in_range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">                    <span class=\"token keyword\">let</span> sphere_material <span class=\"token operator\">=</span> <span class=\"token class-name\">Rc</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Metal</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>albedo<span class=\"token punctuation\">,</span> fuzz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">                    world<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Rc</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Sphere</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>center<span class=\"token punctuation\">,</span> <span class=\"token number\">0.2</span><span class=\"token punctuation\">,</span> sphere_material<span class=\"token punctuation\">.</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>                <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">                    <span class=\"token keyword\">let</span> sphere_material <span class=\"token operator\">=</span> <span class=\"token class-name\">Rc</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Dielectric</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">1.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>;</span></span><span class=\"gatsby-highlight-code-line\">                    world<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Rc</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Sphere</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>center<span class=\"token punctuation\">,</span> <span class=\"token number\">0.2</span><span class=\"token punctuation\">,</span> sphere_material<span class=\"token punctuation\">.</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>;</span></span>                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">let</span> material1 <span class=\"token operator\">=</span> <span class=\"token class-name\">Dielectric</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">1.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    world<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Rc</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Sphere</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Point3</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Rc</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>material1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">let</span> material2 <span class=\"token operator\">=</span> <span class=\"token class-name\">Lambertian</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Color</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    world<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Rc</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Sphere</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Point3</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">4.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Rc</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>material2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">let</span> material3 <span class=\"token operator\">=</span> <span class=\"token class-name\">Metal</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Color</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    world<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Rc</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Sphere</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Point3</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">4.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Rc</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>material3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    world\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Update our camera parameters:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre style=\"counter-reset: linenumber 0\" class=\"language-rust line-numbers\"><code class=\"language-rust\"><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">let</span> aspect_ratio <span class=\"token operator\">=</span> <span class=\"token number\">16.0</span> <span class=\"token operator\">/</span> <span class=\"token number\">9.0</span><span class=\"token punctuation\">;</span></span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">let</span> image_width <span class=\"token operator\">=</span> <span class=\"token number\">400</span><span class=\"token punctuation\">;</span></span>    <span class=\"token keyword\">let</span> image_height <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>image_width <span class=\"token keyword\">as</span> <span class=\"token keyword\">f64</span> <span class=\"token operator\">/</span> aspect_ratio<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">u32</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">let</span> samples_per_pixel <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">let</span> max_depth <span class=\"token operator\">=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">;</span></span>\n    <span class=\"token keyword\">let</span> world <span class=\"token operator\">=</span> <span class=\"token function\">random_scene</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">let</span> lookfrom <span class=\"token operator\">=</span> <span class=\"token class-name\">Point3</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">13.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> lookat <span class=\"token operator\">=</span> <span class=\"token class-name\">Point3</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> dist_to_focus <span class=\"token operator\">=</span> <span class=\"token number\">10.0</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">let</span> cam <span class=\"token operator\">=</span> <span class=\"token class-name\">Camera</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>lookfrom<span class=\"token punctuation\">,</span> lookat<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Vec3</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20.0</span><span class=\"token punctuation\">,</span> aspect_ratio<span class=\"token punctuation\">,</span> <span class=\"token number\">0.1</span><span class=\"token punctuation\">,</span> dist_to_focus<span class=\"token punctuation\">,</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n    <span class=\"token macro property\">print!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"P3\\n{} {}\\n255\\n\"</span><span class=\"token punctuation\">,</span> image_width<span class=\"token punctuation\">,</span> image_height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The result:</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dd18c51cdf7ec4f3afa940507c607453/d9f49/motion-blur.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACm0lEQVQozxWM3U8SAQDA7/9o/Q+19dimOaGVzjYkUPSQj+MbhAPhOO64D44vOQ44IPwCgalN0BQBQaX8WDVdD825NtOntjB7NK0epXz57ffy+wHfrzrtX532defiutO+uv35t3Ny/mPSZcR9vCNZ5ebWKjuHhZXtfLlZe3t02v598afTvrlt39wlwMHJ5f7nb61PZ43Ds82j8+3jS56NwHKxJVzUeRO5Yim/XJ1erM0s1ecW1yvNvebu1+29s+b+WfPjF8BgnDTbsgbNrFY2pYd9Q27yuVhEIEjt/Wl5Y6fe2Ko1WpV6a73eqjZbjc0dF0mDI4hUHhmzhACVQ/fSwoBIFbbnTRKLomugX6aAMXzv+DJdrGOoN8zy0Rif4Pk4xxNM0IGHhlWo0Zc3szEAplnck0eNC970AYa+kjzVPQH9Kp3WiCBSCJWpLSKFUqGxgkbNGKSTjo5gDCfQBodgh5JmAC+7nIHfMcOFPhFic0Y8gaway1oCFYhL96C4chyTqyC5AtJCZg1kgj0MHs6Cetcz0T0bzQGIt2g18I+tOS36xuFKmlNpQ3J21FN7oSeGnE6NLYAzpUER2KMXit2KCTLjZkMwLekbfmAiKMBoTQzKqUcil9wU1w6CT+XCgYBHrKS7umUOOoOEcsaJlBWa6sUVgqSUjJY8hBqH7iMu3MMtAXbfbI/QKgUpb6wo6e2W9PebKN6AsGqr3xNdIFMljF0wCWZAQUDvD+HJZdzmYIQPfW6aSK8CrnhmxIJp7NH42ofY2j5MJNBIAQnPo5PzXm6JSpbIeMmiyNg002Ti9f8XRcRoyESRcXZ+A7DzQZ0fHyd5d3IL4RvO4AzOLZJ82Zda8aXuSPElF5VDAwXmzlfJSAH3ckRorry1+w+8jmBhRreVnAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Bouncing spheres\"\n        title=\"Bouncing spheres\"\n        src=\"/static/dd18c51cdf7ec4f3afa940507c607453/d9f49/motion-blur.png\"\n        srcset=\"/static/dd18c51cdf7ec4f3afa940507c607453/0608e/motion-blur.png 225w,\n/static/dd18c51cdf7ec4f3afa940507c607453/d9f49/motion-blur.png 400w\"\n        sizes=\"(max-width: 400px) 100vw, 400px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Bouncing spheres</figcaption>\n  </figure></p>\n<p>The complete code is <a href=\"https://github.com/austindoupnik/ray-tracing-in-one-weekend-with-rust/tree/v0.0.1-the-next-week-chapter.2\">available here</a>.</p>","frontmatter":{"title":"Ch 2. Motion Blur","series":{"title":"Ray Tracing: The Next Week","part":1},"date":"November 04, 2020","tags":["rust","ray tracing"]},"fields":{"slug":"/post/2020-11/motion-blur/"}}},"pageContext":{"slug":"/post/2020-11/motion-blur/","previous":{"fields":{"slug":"/post/2020-10/where-next/"},"frontmatter":{"title":"Ch 13. Where Next?"}},"next":{"fields":{"slug":"/post/2020-11/bounding-volume-hierarchies/"},"frontmatter":{"title":"Ch 3. Bounding Volume Hierarchies"}}}},"staticQueryHashes":["1242404783","1672915144","1933047930","2463615370"]}